(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{308:function(e,n,t){"use strict";t.r(n);var r=t(17),v=Object(r.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h3",{attrs:{id:"分布式事务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分布式事务","aria-hidden":"true"}},[e._v("#")]),e._v(" 分布式事务")]),e._v(" "),t("ol",[t("li",[e._v("主流的关系型数据库产品都是实现了XA接口，事务管理器和资源管理器之间使用XA协议，JTA(Java Transaction API)。")]),e._v(" "),t("li",[t("code",[e._v("TCC")]),e._v("   try  comfirm   cancel 。")]),e._v(" "),t("li",[t("code",[e._v("本地消息表")]),e._v("\n采用定时轮询扫描的方式，去检查消息表的数据。")]),e._v(" "),t("li",[t("code",[e._v("消息队列")]),e._v("\n采用时效性高的MQ，由对方订阅消息并监听，有消息时自动触发事件。")]),e._v(" "),t("li",[t("code",[e._v("mq事务消息")]),e._v("\nRocketMQ\n第一阶段发送Prepared消息时，会拿到消息的地址，"),t("br"),e._v("\n第二阶段执行本地事物，"),t("br"),e._v("\n第三阶段通过第一阶段拿到的地址去访问消息，并修改状态。"),t("br"),e._v("\n如果确认消息发送失败了，RocketMQ会定期扫描消息集群中的事物消息，"),t("br"),e._v("\n这时候发现了Prepared消息，它会向消息发送者确认，"),t("br"),e._v("\nBob的钱到底是减了还是没减呢，RocketMQ会根据发送端设置的策略来决定是回滚还是继续发送确认消息。"),t("br"),e._v("\n这样就保证了消息发送与本地事务同时成功或同时失败。")]),e._v(" "),t("li",[t("code",[e._v("补偿机制")]),e._v("\n只有当我们回调页面中输出了success字样或者标识业务处理成功相应状态码时，支付宝才会停止回调请求。\n否则，支付宝会每间隔一段时间后，再向客户方发起回调请求，直到输出成功标识为止。")])])])}),[],!1,null,null,null);n.default=v.exports}}]);